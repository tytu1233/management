<!--
 - Created by patryk.witkowski_bri on 4/18/2025.
 -->

<aura:component controller="OpportunityProductsController">
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <aura:attribute name="productsData" type="Object" default="{}"/>
    <aura:attribute name="persistData" type="Object[]" />
    <aura:attribute name="selectedRowIds" type="String[]"/>
    <aura:attribute name="previousSelectedRows" type="Object[]" default="[]" />
    <aura:attribute name="isUserSelection" type="Boolean" default="true" />
    <aura:attribute name="categoriesData" type="Object" default="{}"/>
    <aura:attribute name="options" type="String[]" />
    <aura:attribute name="selectedCategories" type="String[]"/>
    <aura:attribute name="activeSections" type="String" default="" />
    <aura:attribute name="expand" type="Boolean" default="False"/>
    <aura:attribute name="columns" type="List"/>
    <aura:attribute name="pageNumber" type="Integer" default="1" />
    <aura:attribute name="pageSize" type="Integer" default="10" />
    <aura:attribute name="totalRecords" type="Integer" default="0" />
    <aura:attribute name="totalPages" type="Integer" default="0" />
    <aura:attribute name="isLoading" type="Boolean" default="false" />

    <aura:registerEvent name="updateData" type="c:ProductChangeEvent" />


    <div class="slds-form">
        <h3 class="slds-text-heading_small slds-m-bottom_small">Step 1: Add products</h3>
        <div onclick="{!c.handleClick}">
            <lightning:accordion aura:id="accordion">
                <lightning:accordionSection name="categoryFilter" label="Filter by Category">
                </lightning:accordionSection>
            </lightning:accordion>
        </div>
        <aura:if isTrue="{!v.expand}">
            <div class="slds-p-left_small slds-p-bottom_small">
                <lightning:checkboxGroup name="Filter by category"
                                         label=""
                                         options="{!v.categoriesData.productsCategories}"
                                         value="{!v.options}"
                                         onchange="{!c.handleChange}"/>
            </div>
        </aura:if>
        <div slot="body">
            <lightning:datatable
                aura:id="productDatatable"
                keyField="productId"
                data="{!v.productsData}"
                columns="{!v.columns}"
                hideCheckboxColumn="false"
                onrowaction="{!c.handleRowAction}"
                onrowselection="{!c.handleRowSelection}"
                selectedRows="{!v.selectedRowIds}"/>
        </div>

        <div class="slds-align_absolute-center slds-p-top_small">
            <lightning:button label="Previous"
                              iconName="utility:chevronleft"
                              disabled="{!v.pageNumber == 1}"
                              onclick="{!c.handlePrevious}" />
            <span class="slds-badge slds-m-horizontal_small">
                    Page {!v.pageNumber} of {!v.totalPages}
                </span>
            <lightning:button label="Next"
                              iconName="utility:chevronright"
                              disabled="{!v.pageNumber == v.totalPages}"
                              onclick="{!c.handleNext}" />
        </div>

        <div class="slds-float_right">
            <span class="slds-badge">Total Records: {!v.totalRecords}</span>
        </div>
        <div class="{!v.isLoading ? 'spinner-load' : 'slds-hide'}">
            <lightning:spinner aura:id="spinner" alternativeText="Loading" size="large" class="{!v.isLoading ? '' : 'slds-hide'}" />
        </div>
    </div>
</aura:component>